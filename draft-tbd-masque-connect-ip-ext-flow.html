<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>A Flow Forwarding Mode Extension to CONNECT-IP</title>
<meta content="To Be Determined" name="author">
<meta content="
       This document describes an extension to the CONNECT-IP HTTP method. This
extension defines a new Flow Forwarding Mode which supports optimization for
individual IP flows forwarded to the targeted peer. 
       
         
           IMPORTANT NOTE: This draft exists only to demonstrate the feasibility of
defining CONNECT-IP Flow Forwarding Mode as an extension to CONNECT-IP. The
overwhelming majority of the content in this draft was copied from
draft-kuehlewind-masque-connect-ip-01. A list of changes from that design is
available in an appendix to this document. All credit for flow forwarding
should go to the authors of that document. However, all blame for any errors
in this draft should be attributed to its editor. The editor's intent is to
step down as editor of this draft and have the authors of
draft-kuehlewind-masque-connect-ip take on that role. 
         
       
    " name="description">
<meta content="xml2rfc 3.24.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-tbd-masque-connect-ip-ext-flow-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.24.0
    Python 3.12.7
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-tbd-masque-connect-ip-ext-flow.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
  }
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CONNECT-IP Flow Forwarding</td>
<td class="right">November 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Determined</td>
<td class="center">Expires 10 May 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">MASQUE</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-tbd-masque-connect-ip-ext-flow-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-11-06" class="published">6 November 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-05-10">10 May 2025</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. B. Determined</div>
<div class="org">MASQUE Enthusiasts LLC</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">A Flow Forwarding Mode Extension to CONNECT-IP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes an extension to the CONNECT-IP HTTP method. This
extension defines a new Flow Forwarding Mode which supports optimization for
individual IP flows forwarded to the targeted peer.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-2.1">
          <p id="section-abstract-2.1.1">IMPORTANT NOTE: This draft exists only to demonstrate the feasibility of
defining CONNECT-IP Flow Forwarding Mode as an extension to CONNECT-IP. The
overwhelming majority of the content in this draft was copied from
draft-kuehlewind-masque-connect-ip-01. A list of changes from that design is
available in an appendix to this document. All credit for flow forwarding
should go to the authors of that document. However, all blame for any errors
in this draft should be attributed to its editor. The editor's intent is to
step down as editor of this draft and have the authors of
draft-kuehlewind-masque-connect-ip take on that role.<a href="#section-abstract-2.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
  Multiplexed Application Substrate over QUIC Encryption Working Group mailing list (masque@ietf.org),
  which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/masque/">https://mailarchive.ietf.org/arch/browse/masque/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/DavidSchinazi/draft-cms-masque-connect-ip">https://github.com/DavidSchinazi/draft-cms-masque-connect-ip</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 10 May 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-motivation-of-ip-flow-model" class="internal xref">Motivation of IP flow model for flow forwarding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-definitions" class="internal xref">Definitions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-conventions" class="internal xref">Conventions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-negotiating-flow-forwarding" class="internal xref">Negotiating Flow Forwarding Mode</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-http-datagram-multiplexing-" class="internal xref">HTTP Datagram Multiplexing and Encoding</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-ip-payloads" class="internal xref">IP Payloads</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="auto internal xref">3.1.1</a>.  <a href="#name-ip-payload-capsule" class="internal xref">IP Payload Capsule</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="auto internal xref">3.1.2</a>.  <a href="#name-ip-payload-http-datagram-fo" class="internal xref">IP Payload HTTP Datagram Format</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-icmp" class="internal xref">ICMP</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="auto internal xref">3.2.1</a>.  <a href="#name-icmp-capsule" class="internal xref">ICMP Capsule</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="auto internal xref">3.2.2</a>.  <a href="#name-icmp-http-datagram-format" class="internal xref">ICMP HTTP Datagram Format</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-http-headers" class="internal xref">HTTP Headers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-flow-forwarding-header-for-" class="internal xref">Flow-Forwarding header for CONNECT-IP</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-ip-protocol-header-for-conn" class="internal xref">IP-Protocol Header for CONNECT-IP</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-ip-version-header-for-conne" class="internal xref">IP-Version header for CONNECT-IP</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-ip-address-header-for-conne" class="internal xref">IP-Address header for CONNECT-IP</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-ip-address-handling-header-" class="internal xref">IP-Address-Handling Header for CONNECT-IP</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-conn-id-header-for-connect-" class="internal xref">Conn-ID Header for CONNECT-IP</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-masque-server-behavior" class="internal xref">MASQUE server behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-error-handling" class="internal xref">Error handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-ip-address-selection" class="internal xref">IP address selection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-constructing-the-ip-header" class="internal xref">Constructing the IP header</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-receiving-an-ip-packet" class="internal xref">Receiving an IP packet</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-additional-signalling" class="internal xref">Additional signalling</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-ecn" class="internal xref">ECN</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-icmp-handling" class="internal xref">ICMP handling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-mtu-considerations" class="internal xref">MTU considerations</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations" class="internal xref">Security considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-iana-considerations" class="internal xref">IANA considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-http-header" class="internal xref">HTTP Header</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-changes-from-draft-kuehlewi" class="internal xref">Changes from draft-kuehlewind-masque-connect-ip-01</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes an extension to the CONNECT-IP HTTP method
<span>[<a href="#CONNECT-IP" class="cite xref">CONNECT-IP</a>]</span>. This extension defines a new Flow
Forwarding Mode which supports optimization for individual IP flows forwarded
to the targeted peer.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In flow forwarding mode the CONNECT-IP method establishes an outgoing IP flow,
from the MASQUE server's external address to the target server's address
specified by the client for a particular upper layer protocol. This mode also
enables reception and relaying of the reverse IP flow from the target address
to the MASQUE server to ensure that return traffic can be received by the
client. However, it does not support flow establishment by an external peer.
This specification supports forwarding of incoming traffic to one of the
clients only if an active mapping has previously been created based on an
CONNECT-IP request. Clients that need to support reception of flows established
by external peer need to use regular CONNECT-IP.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This mode allows for flow-based optimizations and a larger effective maximum
packet size through the tunnel. The target IP address is provided by the client
as part of the CONNECT-IP request. The source address is either independently
selected by the proxy or can be requested to be either the same as used in a
previous and currently active CONNECT-IP request or different from currently
requests by the same client. The client also indicates the upper layer
protocol, thus defining the three tuple used as primary selector for the flow.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">In this mode the payload between the client and proxy does not contain the IP
header in order to reduce overhead. Any additional information (other than the
source and destination IP addresses and ports as well as the upper layer
protocol identifier) that is needed to construct the IP header or to inform the
client about information from received IP packets can be signalled as part of
the CONNECT-IP request or using HTTP/3 Datagram
<span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span> later.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">In flow forwarding mode, usually one upper-layer end-to-end connection is
associated to one CONNECT-IP forwarding association. While it would be possible
for a client to use the same forwarding association for multiple end-to-end
connections to the same target server, as long as they all require the same
Protocol (IPv4) / Next Header (IPv6) value, this would lead to the use of the
same flow ID for all connections. As such, this is not recommended for
connection-oriented transmissions. In order to enable multiple flow forwarding
associations to the same server, the flow forwarding mode supports a way to
specify some additional upper layer protocol selectors, e.g. TCP source and
destination port, to enable multiple CONNECT-IP request for the same three
tuple, see CONN-ID header (<a href="#conn-id" class="auto internal xref">Section 4.6</a>).<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The default model for address handling in this specification is that the proxy
(MASQUE Server) will have a pool of one or more IP addresses that it can lend
to the MASQUE client and routable over its external interface. Other potential
use cases and address handling are possible, potentially requiring further
extensions.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This proposal is based on the analysis provided in
<span>[<a href="#I-D.westerlund-masque-transport-issues" class="cite xref">I-D.westerlund-masque-transport-issues</a>]</span> indicating that most
information in the IP header is either IP flow related or can or even
should be provided by the proxy as the IP communication endpoint
without the need for input from the client.  The most crucial
information identified that requires client interaction is ECN
<span>[<a href="#RFC3168" class="cite xref">RFC3168</a>]</span> and ICMP <span>[<a href="#RFC0792" class="cite xref">RFC0792</a>]</span> <span>[<a href="#RFC4443" class="cite xref">RFC4443</a>]</span> handling.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">This document defines the following IP header field treatment.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">Required to be determined in CONNECT-IP request and response:<a href="#section-1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-10.1">
          <p id="section-1-10.1.1">IP version<a href="#section-1-10.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-10.2">
          <p id="section-1-10.2.1">IP Source Address<a href="#section-1-10.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-10.3">
          <p id="section-1-10.3.1">IP Destination Address (target address)<a href="#section-1-10.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-10.4">
          <p id="section-1-10.4.1">Upper Layer Protocol (IPv4 Protocol field / IPv6 Next Header field)<a href="#section-1-10.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-11">Can be chosen by Proxy on transmission:<a href="#section-1-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-12.1">
          <p id="section-1-12.1.1">IPv6 Flow label (per CONNECT-IP flow mode request)<a href="#section-1-12.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-12.2">
          <p id="section-1-12.2.1">IPv4 Time to live / IPv6 Hop Limit (proxy configured)<a href="#section-1-12.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-12.3">
          <p id="section-1-12.3.1">Diffserv Codepoint, default is set to 0 (Best Effort)<a href="#section-1-12.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-13">May optionally be provided on a per packet basis<a href="#section-1-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-14.1">
          <p id="section-1-14.1.1">Explicit Congestion Notification in both directions.<a href="#section-1-14.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-15">The consequence of this is certain limitations that future extension can
address. For packets that are sent from the target server to the client, the
client will not get any information on the actual value of TTL/Hop Count, DSCP,
or flow label when received by the proxy. Instead these field are set and
consumed by the proxy only.<a href="#section-1-15" class="pilcrow">¶</a></p>
<p id="section-1-16">Signalling of other dedicated values may be desired in certain deployments, e.g
for DCSP <span>[<a href="#RFC2474" class="cite xref">RFC2474</a>]</span>. However, DSCP is in any case a challenge due to local
domain dependency of the used DSCP values and the forwarding behavior and
traffic treatment they represent. Future use cases for DSCP, as well as new
IPv6 extension headers or destination header options <span>[<a href="#RFC8200" class="cite xref">RFC8200</a>]</span> may require
additional signaling. Therefore, it is important that the signaling is
extensible.<a href="#section-1-16" class="pilcrow">¶</a></p>
<div id="motivation-of-ip-flow-model-for-flow-forwarding">
<section id="section-1.1">
        <h3 id="name-motivation-of-ip-flow-model">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-motivation-of-ip-flow-model" class="section-name selfRef">Motivation of IP flow model for flow forwarding</a>
        </h3>
<p id="section-1.1-1">The chosen IP flow model is selected due to several advantages:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.1">
            <p id="section-1.1-2.1.1">Minimized per packet overhead: The per packet overhead is reduced
  to basic framing of the IP payload for each IP packet and flow
  identifiers.  This enables a larger effective Maximum Transmission
  Unit (MTU) than regular CONNECT-IP.<a href="#section-1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.2">
            <p id="section-1.1-2.2.1">Shared functionality with CONNECT-UDP: The UDP flow proxying
  functionality of CONNECT-UDP will need to establish, store and
  process the same IP header related fields and state.  So this can
  be accomplished by simply removing the UDP specific processing of
  packets.<a href="#section-1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-2.3">
            <p id="section-1.1-2.3.1">CONNECT-IP can establish a new IP flow in 0-RTT: No network
  related latencies in establishing new flow.<a href="#section-1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.1-3">Disadvantages of this model are the following:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">
            <p id="section-1.1-4.1.1">Client to server focused solution: Accepting non-solicited peer-
  initiated traffic is not supported.<a href="#section-1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="definitions">
<section id="section-1.2">
        <h3 id="name-definitions">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-definitions" class="section-name selfRef">Definitions</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-1.2-1.1">
            <p id="section-1.2-1.1.1">Proxy: This document uses proxy as synonym for the MASQUE Server
  or an HTTP proxy, depending on context.<a href="#section-1.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-1.2">
            <p id="section-1.2-1.2.1">Client: The endpoint initiating a MASQUE tunnel and IP relaying
  with the proxy.<a href="#section-1.2-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-1.3">
            <p id="section-1.2-1.3.1">Target host: A remote endpoint the client wishes to establish bi-
  directional communication with via tunnelling over the proxy.<a href="#section-1.2-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-1.4">
            <p id="section-1.2-1.4.1">IP proxying: A proxy forwarding IP payloads to a target for an IP
  flow.  Data is decapsulate at the proxy and amended by a IP header
  before forwarding to the target.  Packet boundaries need to be
  preserved or signalled between the client and proxy.<a href="#section-1.2-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-1.5">
            <p id="section-1.2-1.5.1">IP flow: A flow of IP packets between two hosts as identified by
  their IP addresses, and where all the packets share some
  properties.  These properties include source/destination address,
  protocol / next header field, flow label (IPv6 only), and DSCP per
  direction.<a href="#section-1.2-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-1.6">
            <p id="section-1.2-1.6.1">Address = IP address<a href="#section-1.2-1.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<span id="name-the-nodes-and-their-address"></span><div id="fig-nodes">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.2-2.1">
<pre>
                     Target Address --+
                                       \
+--------+           +--------+         \ +--------+
|        |  Path #1  |        | Path #2  V|        |
| Client |&lt;---------&gt;|  Proxy |&lt;---------&gt;| Target |
|        |          ^|        |^          |        |
+--------+         / +--------+ \         +--------+
                  /              \
                 /                +-- Proxy's external address
                /
               +-- Proxy's service address
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-the-nodes-and-their-address" class="selfRef">The nodes and their addresses</a>
          </figcaption></figure>
</div>
<p id="section-1.2-3"><a href="#fig-nodes" class="auto internal xref">Figure 1</a> provides an overview figure of the involved nodes, i.e. client,
proxy, and target host. There are also two network paths. Path #1 is the client
to proxy path, where IP proxying is provided over an HTTP/3 session, usually
over QUIC, to tunnel IP flow(s). Path #2 is the path between the proxy and the
target.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">The client will use the proxy's service address to establish a transport
connection on which to request IP proxying using HTTP/3 CONNECT-IP. The proxy
will then relay the client's IP flows to the target host. The IP header from
the proxy to the target carries the proxy's external address as source address
and the target's address as destination address.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions">
<section id="section-1.3">
        <h3 id="name-conventions">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-conventions" class="section-name selfRef">Conventions</a>
        </h3>
<p id="section-1.3-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span>
when, and only when, they appear in all capitals, as shown here.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="negotiating-flow-forwarding-mode">
<section id="section-2">
      <h2 id="name-negotiating-flow-forwarding">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-negotiating-flow-forwarding" class="section-name selfRef">Negotiating Flow Forwarding Mode</a>
      </h2>
<p id="section-2-1">To request flow forwarding, the client sends a CONNECT-IP request to the
forwarding proxy indicating the target host and port in the Flow-Forwarding
header field (<a href="#ffd" class="auto internal xref">Section 4.1</a>). The host portion is either an IP literal encapsulated
within square brackets, an IPv4 address in dotted-decimal form, or a registered
name. Further the CONNECT-IP request MUST contain the IP-Protocol header
(<a href="#ip-proto" class="auto internal xref">Section 4.2</a>) and MAY contain the IP-Address-Handling (<a href="#ip-addr-handling" class="auto internal xref">Section 4.5</a>)
or the Conn-ID (<a href="#conn-id" class="auto internal xref">Section 4.6</a>) header.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">If the server accepts the request, it responds with a 2xx (Successful) response
that echoes the Flow-Forwarding header field (<a href="#ffd" class="auto internal xref">Section 4.1</a>). The client can
optimistically register its IP payload context ID (<a href="#payload-capsule" class="auto internal xref">Section 3.1.1</a>) and
start sending IP payloads (<a href="#payload-format" class="auto internal xref">Section 3.1.2</a>) before it receives the server
response. If the server rejects the request or does not support flow forwarding
mode, those datagrams will be dropped.<a href="#section-2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="http-datagram-multiplexing-and-encoding">
<section id="section-3">
      <h2 id="name-http-datagram-multiplexing-">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-http-datagram-multiplexing-" class="section-name selfRef">HTTP Datagram Multiplexing and Encoding</a>
      </h2>
<p id="section-3-1">Flow forwarding mode requires multiplexing multiple types of HTTP Datagrams
over a single CONNECT-IP request: IP payloads and ICMP messages. To allow this,
clients register HTTP Datagram Context IDs using capsules <span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="ip-payloads">
<section id="section-3.1">
        <h3 id="name-ip-payloads">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-ip-payloads" class="section-name selfRef">IP Payloads</a>
        </h3>
<p id="section-3.1-1">In order to exchange IP payloads, the client starts by using its context ID
allocation service <span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span> to allocate a context ID. It then
communicates that context ID to the server using a
REGISTER_DATAGRAM_CONTEXT_IP_PAYLOAD capsule (<a href="#payload-capsule" class="auto internal xref">Section 3.1.1</a>). Once that
is done, both endpoints can exchange IP Payloads (<a href="#payload-format" class="auto internal xref">Section 3.1.2</a>).<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div id="payload-capsule">
<section id="section-3.1.1">
          <h4 id="name-ip-payload-capsule">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-ip-payload-capsule" class="section-name selfRef">IP Payload Capsule</a>
          </h4>
<p id="section-3.1.1-1">The REGISTER_DATAGRAM_CONTEXT_IP_PAYLOAD capsule (type=0xfff801) allows an
endpoint to inform its peer of the encoding and semantics of IP Payload
datagrams associated with a given context ID. Its Capsule Data field consists
of:<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<span id="name-register_datagram_context_i"></span><div id="payload-capsule-format">
<figure id="figure-2">
            <div class="alignLeft art-text artwork" id="section-3.1.1-2.1">
<pre>
REGISTER_DATAGRAM_CONTEXT_IP_PAYLOAD Capsule {
  Context ID (i),
}
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-register_datagram_context_i" class="selfRef">REGISTER_DATAGRAM_CONTEXT_IP_PAYLOAD Capsule Format</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.1.1-3">
            <dt id="section-3.1.1-3.1">Context ID:</dt>
            <dd style="margin-left: 1.5em" id="section-3.1.1-3.2">
              <p id="section-3.1.1-3.2.1">The context ID to register.<a href="#section-3.1.1-3.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="payload-format">
<section id="section-3.1.2">
          <h4 id="name-ip-payload-http-datagram-fo">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-ip-payload-http-datagram-fo" class="section-name selfRef">IP Payload HTTP Datagram Format</a>
          </h4>
<p id="section-3.1.2-1">HTTP Datagrams registered to carry IP Payloads contain the IP payload. This is
defined as the payload following the IPv4 header and any options for IPv4, and
for IPv6 as the payload following the IPv6 header and any extension header.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="icmp">
<section id="section-3.2">
        <h3 id="name-icmp">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-icmp" class="section-name selfRef">ICMP</a>
        </h3>
<p id="section-3.2-1">In order to exchange ICMP messages, the client starts by using its context ID
allocation service <span>[<a href="#HTTP-DGRAM" class="cite xref">HTTP-DGRAM</a>]</span> to allocate a context ID. It then
communicates that context ID to the server using a
REGISTER_DATAGRAM_CONTEXT_ICMP capsule (<a href="#icmp-capsule" class="auto internal xref">Section 3.2.1</a>). Once that is done,
both endpoints can exchange ICMP messages (<a href="#icmp-format" class="auto internal xref">Section 3.2.2</a>).<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div id="icmp-capsule">
<section id="section-3.2.1">
          <h4 id="name-icmp-capsule">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-icmp-capsule" class="section-name selfRef">ICMP Capsule</a>
          </h4>
<p id="section-3.2.1-1">The REGISTER_DATAGRAM_CONTEXT_ICMP capsule (type=0xfff802) allows an endpoint
to inform its peer of the encoding and semantics of ICMP datagrams associated
with a given context ID. Its Capsule Data field consists of:<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<span id="name-register_datagram_context_ic"></span><div id="payload-icmp-format">
<figure id="figure-3">
            <div class="alignLeft art-text artwork" id="section-3.2.1-2.1">
<pre>
REGISTER_DATAGRAM_CONTEXT_ICMP Capsule {
  Context ID (i),
}
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-register_datagram_context_ic" class="selfRef">REGISTER_DATAGRAM_CONTEXT_ICMP Capsule Format</a>
            </figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-3">
            <dt id="section-3.2.1-3.1">Context ID:</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-3.2">
              <p id="section-3.2.1-3.2.1">The context ID to register.<a href="#section-3.2.1-3.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="icmp-format">
<section id="section-3.2.2">
          <h4 id="name-icmp-http-datagram-format">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-icmp-http-datagram-format" class="section-name selfRef">ICMP HTTP Datagram Format</a>
          </h4>
<p id="section-3.2.2-1">HTTP Datagrams registered to carry ICMP messages contain a summary message of
the ICMP message received and validated for the respective IP flow. The message
format carries the ICMP packet for ICMPv4 <span>[<a href="#RFC0792" class="cite xref">RFC0792</a>]</span> or ICMPv6 <span>[<a href="#RFC4443" class="cite xref">RFC4443</a>]</span>.
This format is chosen for forward compatibility. From an implementation
perspective the client don't need to verify the checksum or validate the header
fields because that is done by the server. However, some type codes, like
IMCPv4 type 2, (Packet Too Big) carries an MTU field that the implementation
want to read beyond understanding the meaning of the type and code combination.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="http-headers">
<section id="section-4">
      <h2 id="name-http-headers">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-http-headers" class="section-name selfRef">HTTP Headers</a>
      </h2>
<p id="section-4-1">Note: This section should be improved by clarifying if headers are in request,
response or both.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="ffd">
<section id="section-4.1">
        <h3 id="name-flow-forwarding-header-for-">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-flow-forwarding-header-for-" class="section-name selfRef">Flow-Forwarding header for CONNECT-IP</a>
        </h3>
<p id="section-4.1-1">Flow-Forwarding is an Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its value MUST be a
String containing either an IPv6 literal encapsulated within square brackets,
an IPv4 address in dotted-decimal form, or a registered name.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
Flow-Forwarding = sf-string
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ip-proto">
<section id="section-4.2">
        <h3 id="name-ip-protocol-header-for-conn">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-ip-protocol-header-for-conn" class="section-name selfRef">IP-Protocol Header for CONNECT-IP</a>
        </h3>
<p id="section-4.2-1">In order to construct the IP header the the proxy needs to fill the "Protocol"
field in the IPv4 header or "Next header" field in the IPv6 header. As the IP
payload is otherwise mostly opaque to the proxy, this information has to be
provided by the client for each CONNECT-IP request for flow forwarding.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">IP-Protocol is a Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its value MUST be an
Integer. Its ABNF is:<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-3">
<pre>
IP-Protocol = sf-integer
</pre><a href="#section-4.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ip-version">
<section id="section-4.3">
        <h3 id="name-ip-version-header-for-conne">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-ip-version-header-for-conne" class="section-name selfRef">IP-Version header for CONNECT-IP</a>
        </h3>
<p id="section-4.3-1">IP-Version is a Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its value MUST be an
Integer and either 4 or 6. This information is used by the proxy to check if
the requested IP version is supported by the network that the proxy is
connected to, as well as to check the destination or source IP address for
compliance.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-2">
<pre>
IP-Version = sf-integer
</pre><a href="#section-4.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ip-addr">
<section id="section-4.4">
        <h3 id="name-ip-address-header-for-conne">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-ip-address-header-for-conne" class="section-name selfRef">IP-Address header for CONNECT-IP</a>
        </h3>
<p id="section-4.4-1">IP-Address is an Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its value MUST be an
String contain an IP address or IP address range of the same IP version as
indicated in the IP-Version header. The address must be specified in the format
specified by TBD.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">This header is used to request the use of a certain IP address or IP address
range by the client to be used as source IP address. If the IP-Address header
is not presented, the proxy is implicitly requested to assign an IP address or
IP address range and provide this information to the client with the HTTP
response.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">If the the client does not provide an IP address or IP address range is has to
wait for the proxy response before any payload data can be sent. If the request
is denied by the proxy, any sent payload data will be discarded and a new
CONNECT-IP request has to be sent.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">The header is also used as a response header from the proxy to the client to
indicate the actual IP address or IP address range that will be used by the
proxy.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-5">
<pre>
IP-Address = sf-string
</pre><a href="#section-4.4-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="ip-addr-handling">
<section id="section-4.5">
        <h3 id="name-ip-address-handling-header-">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-ip-address-handling-header-" class="section-name selfRef">IP-Address-Handling Header for CONNECT-IP</a>
        </h3>
<p id="section-4.5-1">This header can be used to request the use of a stable address for multiple
active flow forwarding associations. The first association will be established
with an IP selected by the proxy unless also the IP-Address header
(<a href="#ip-addr" class="auto internal xref">Section 4.4</a>) is provided and accepted by proxy. However, additional forwarding
association can be requested by the client to use the same IP address as a
previous request by specifying the stream ID as value in this header. This
header can also be used to ensure that a "new", not yet for this client used
address is selected by setting a value that is larger than the maximum stream
ID.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">IP-Address-Handling is a Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its value MUST be
an Integer and indicates the stream ID of the corresponding active flow
forwarding association. Its ABNF is:<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-3">
<pre>
IP-Address-Handling = sf-integer
</pre><a href="#section-4.5-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="conn-id">
<section id="section-4.6">
        <h3 id="name-conn-id-header-for-connect-">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-conn-id-header-for-connect-" class="section-name selfRef">Conn-ID Header for CONNECT-IP</a>
        </h3>
<p id="section-4.6-1">This document further defines a new header field to be used with CONNECT-IP
"Conn-ID". The Conn-ID HTTP header field indicates the value, offset, and
length of a field in the IP payload that can be used by the proxy as a
connection identifier in addition to the IP address and protocol tuple when
multiple connections are proxied to the same target server for incoming traffic
on the service address.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">Conn-ID is a Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its value MUST be a Byte
Sequence. Its ABNF is:<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-3">
<pre>
 Conn-ID = sf-binary
</pre><a href="#section-4.6-3" class="pilcrow">¶</a>
</div>
<p id="section-4.6-4">The following parameters are defined:<a href="#section-4.6-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6-5.1">
            <p id="section-4.6-5.1.1">A parameter whose name is "offset", and whose value is an Integer indicating
the offset of the identifier field starting from the beginning of a datagram
or HTTP frame on the forwarding stream.<a href="#section-4.6-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.6-5.2">
            <p id="section-4.6-5.2.1">A parameter whose name is "length", and whose value is an Integer indicating
the length of the identifier field starting from the offset.<a href="#section-4.6-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.6-6">Both parameters MUST be present and the header MUST be ignored if these
parameter are not present.<a href="#section-4.6-6" class="pilcrow">¶</a></p>
<p id="section-4.6-7">This function can be used to e.g. indicate the source port field in the IP
payload when containing a TCP packet.<a href="#section-4.6-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="masque-server-behavior">
<section id="section-5">
      <h2 id="name-masque-server-behavior">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-masque-server-behavior" class="section-name selfRef">MASQUE server behavior</a>
      </h2>
<p id="section-5-1">A MASQUE server that receives an CONNECT-IP request examines the request
headers to determine if this request is for flow forwarding mode or regular
CONNECT-IP. If flow forwarding mode is in use, the server determines if the
required headers are present and which of the optional headers that are
included.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">A server that supports flow forwarding mode MUST echo the client's
Flow-Forwarding header to indicate support.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The proxy maintains a database with mappings between the HTTP connections and
stream IDs and the IP level selectors and Conn-ID information. Using this
database and the pool of available addresses and the requests
IP-Address-Handling, Conn-ID, IP-Version, IP-Address headers (if included) to
select a source IP address. This selection for flow forwarding mode is further
discussed below in <a href="#addr-selection" class="auto internal xref">Section 5.2</a>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Once the mapping is successfully established, the proxy sends a HEADERS frame
containing a 2xx series status code to the client. The response MUST contain an
IP-Address header indicating the outgoing source IP address or IP address range
selected by the proxy.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">All Datagram capsules received on that stream as well as all HTTP/3 datagrams
belonging to this CONNECT-IP association are processed for forwarding to the
target server. Datagrams are processed as specified in <a href="#construct" class="auto internal xref">Section 5.3</a> to produce
IP packets that can be forwarded.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">IP packets received from the target server are mapped to an active forwarding
connection and are respectively forwarded in an HTTP datagram to the client
(see <a href="#recv" class="auto internal xref">Section 5.4</a>).<a href="#section-5-6" class="pilcrow">¶</a></p>
<div id="error-handling">
<section id="section-5.1">
        <h3 id="name-error-handling">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-error-handling" class="section-name selfRef">Error handling</a>
        </h3>
<p id="section-5.1-1">TBD (e.g. out of IP address, conn-id collision)<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="addr-selection">
<section id="section-5.2">
        <h3 id="name-ip-address-selection">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-ip-address-selection" class="section-name selfRef">IP address selection</a>
        </h3>
<p id="section-5.2-1">In flow forwarding mode the proxy constructs the IP header when sending the IP
payload towards the target server and it selects an source IP address from its
pool of IP addresses that are routed to the MASQUE server.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">If no additional information about a payload field that can be used as an
identifier based on Conn-ID header is provided by the client, the proxy uses
the source/destination address and protocol ID 3-tuple in order to map an
incoming IP packet to an active forwarding connection. The proxy MUST also
consider if IP-Address-Handling header (<a href="#ip-addr-handling" class="auto internal xref">Section 4.5</a>) is included and
its value. If the IP-Address-Handling header is not included and the there has
been prior request the proxy SHOULD give the client the same source Address as
the first flow forwarding request. Given these constraints the MASQUE proxy
MUST select a source IP address that leads to a unique tuple, and if that is
not possible an error response is generated. The same IP address MAY be used
for different clients when those client connect to different target servers.
However, this also means that potentially multiple IP address are used for the
same client when multiple connection to one target server are needed. This can
be problematic if the source address is used by the target as an identifier.
Therefore it is RECOMMENDED that clients are given unique addresses unless a
large fraction of the pool has been exhausted.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">If the Conn-ID header is provided, the proxy should use that field as an
connection identifier together with protocol ID, source and destination
address, as a 4-tuple. In this case it is recommended to use a stable IP
address for each client, while the same IP address might still be used for
multiple clients, if not indicated differently by the client in the
configuration file. Note that if the same IP address is used for multiple
clients, this can still lead to an identifier collision and the CONNECT-IP
request MUST be reject if such a collision is detect.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">Note: Are we allowing multiple client's to share the same 3-tuple when using
Conn-ID? It might be good for privacy reasons however, it significantly
increases the collision risk.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="construct">
<section id="section-5.3">
        <h3 id="name-constructing-the-ip-header">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-constructing-the-ip-header" class="section-name selfRef">Constructing the IP header</a>
        </h3>
<p id="section-5.3-1">To retrieve the source and destination address the proxy looks up the mapping
for the datagram flow ID or stream identifier. The IP version, flow label,
DiffServ codepoint (DSCP), and hop limit/TTL is selected by the proxy. The IPv4
Protocol or IPv6 Next Header field is set based on the information provided by
the IP-Protocol header in the CONNECT-IP request.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">The proxy MUST set the Don't Fragment (DF) flag in the IPv4 header. Payload
that does not fit into one IP packet MUST be dropped. A dropping indication
should be provided to the client. Further the proxy should provide MTU
information.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">The ECN field is by default set to non-ECN capable transport (non- ECT).
Further ECN handling is described in <a href="#ecn" class="auto internal xref">Section 6.1</a>.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="recv">
<section id="section-5.4">
        <h3 id="name-receiving-an-ip-packet">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-receiving-an-ip-packet" class="section-name selfRef">Receiving an IP packet</a>
        </h3>
<p id="section-5.4-1">When the proxy receives an incoming IP packet on the external interface(s), it
checks the packet selectors to find the mappings that match the given packet.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">If one or more mappings exists, it further checks if this mapping contains
additional identifier information as provided by the Conn-ID Header of the
CONNECT-IP request. If this field maps as well, the IP payload is forwarded to
the client. If no active mapping is found, the IP packet is discarded.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">The above is achieve by using the selector with the most number of fields that
match the packet.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="additional-signalling">
<section id="section-6">
      <h2 id="name-additional-signalling">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-additional-signalling" class="section-name selfRef">Additional signalling</a>
      </h2>
<div id="ecn">
<section id="section-6.1">
        <h3 id="name-ecn">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-ecn" class="section-name selfRef">ECN</a>
        </h3>
<p id="section-6.1-1">ECN requires coordination with the end-to-end communication points as it should
only be used if the endpoints are also capable and willing to signal congestion
notifications to the other end and react accordingly if a congestion
notification is received.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">The probing and verification in the upper layer protocol of end-to-end ECN
requires per packet control over what value is set on IP packet transmission as
well as which of all values are received by the proxy. The QUIC specification
is providing one such example in Section 13.4 of <span>[<a href="#RFC9000" class="cite xref">RFC9000</a>]</span>. Thus in flow
forwarding mode the proxy needs to be able to set and read the ECN values in
sent and received IP packets respectively. This may motivate that this
functionality is optional to implement, even if supporting CONNECT-IP
implementations in general will need to handle IP packets and their fields with
fine grained control. If optional some negotiation mechanism is needed.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Possible realizations are:<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-4.1">
            <p id="section-6.1-4.1.1">always have two bits before payload in flow forwarding model, e.g.
by including the whole Type of Service (TOS) byte, which would also
enable DSCP setting and reading.<a href="#section-6.1-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-4.2">
            <p id="section-6.1-4.2.1">use 4 different context IDs depending on what ECN field value was
received or should be set.<a href="#section-6.1-4.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-5">This is work in process and will be further specified in a future
version of this document.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="icmp-handling">
<section id="section-6.2">
        <h3 id="name-icmp-handling">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-icmp-handling" class="section-name selfRef">ICMP handling</a>
        </h3>
<p id="section-6.2-1">In flow forwarding mode a ICMP datagram format (<a href="#icmp-format" class="auto internal xref">Section 3.2.2</a>) is used to
send the information from some ICMP message to the client.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">The proxy upon receiving an ICMP message with a destination of an IP address it
performs flow forwarding on it needs to process the ICMP message. First it
should validate that the ICMP message and find if it matches any of its IP flow
selectors (including Conn-ID). In case there are multiple matching use the IP
selector with the most number of field that matches fully.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">Some messages may be applicable both to the proxy and the client. For example
an verified ICMPv6 Packet Too Big is applicable both to the proxy and the
client. Others like ICMPv6 Destination Unreachable (Type=1), Code=3 (Address
unreachable) and Code=4 (Port unreachable) is only possible to act on by the
client.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">QUESTION: Which ICMP messages should be suppressed by the proxy?<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">If a matching IP selector was chosen, then lookup the mapping for the HTTP
connection and Stream ID which this message should be sent to. Encapsulate the
received ICMP message in the ICMP datagram format and send it to the client.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mtu-considerations">
<section id="section-6.3">
        <h3 id="name-mtu-considerations">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-mtu-considerations" class="section-name selfRef">MTU considerations</a>
        </h3>
<p id="section-6.3-1">The use of QUIC as a encapsulation between the client and proxy introduces
additional overhead. If datagrams are used to encapsulate packets between the
proxy and client, the end-to-end packets must fit within one datagram but the
size of the datagrams is limited by the tunneling encapsulation overhead.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">In flow forwarding mode the client is usually also the tunnel endpoint that
knows about the tunnel overhead and can therefore restrict the size of the
packets on the end-to-end connection accordingly. However, the target endpoint
is usually not aware of the tunnel overhead. Additional signalling on the
end-to-end connection from the client to the target endpoint might be needed to
restrict the packet size. If QUIC is also used as end-to-end protocol, this
could be realized by the transport parameter. In additional, signal from the
proxy to the client could be provided as an extension to indicate the tunnel
overhead more accurately and flexibly over time. Such signalling might the
realized on the HTTP layer in order to take any additional limitations by HTTP
intermediates into account.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">If the proxy receives an incoming packet from a target endpoint that is too big
to fit within a datagram on the tunnel connection, the proxy MAY either forward
the packet encapsulated in the CAPSULE frames on the respective stream or, if
IPv4 with DF bit set or IPv6 is used, the proxy MAY reject the packet and send
an ICMPv4 Packet type 3 code 4, or ICMPv6 Too Big (PTB) message.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="section-7">
      <h2 id="name-examples">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-7-1">TBD<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<p id="section-8-1">This document does currently not discuss risks that are generic to the MASQUE
approach.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Any CONNECT-IP specific risks need further consideration in future, especially
when the handling of IP functions is defined in more detail.<a href="#section-8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA considerations</a>
      </h2>
<div id="http-header">
<section id="section-9.1">
        <h3 id="name-http-header">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-http-header" class="section-name selfRef">HTTP Header</a>
        </h3>
<p id="section-9.1-1">This document (if published as RFC) registers the following headers in the
"Permanent Message Header Field Names" registry maintained at
<a href="https://www.iana.org/assignments/message-headers">https://www.iana.org/assignments/message-headers</a>.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.1-2">
<pre>
+---------------------+----------+--------+---------------+
| Header Field Name   | Protocol | Status |   Reference   |
+---------------------+----------+--------+---------------+
| Flow-Forwarding     |   http   |  exp   | This document |
+---------------------+----------+--------+---------------+
| Conn-ID             |   http   |  exp   | This document |
+---------------------+----------+--------+---------------+
| IP-Protocol         |   http   |  exp   | This document |
+---------------------+----------+--------+---------------+
| IP-Address          |   http   |  exp   | This document |
+---------------------+----------+--------+---------------+
| IP-Address-Handling |   http   |  exp   | This document |
+---------------------+----------+--------+---------------+
| IP-Version          |   http   |  exp   | This document |
+---------------------+----------+--------+---------------+
</pre><a href="#section-9.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="sec-combined-references">
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="CONNECT-IP">[CONNECT-IP]</dt>
        <dd>
<span class="refAuthor">Chernyakhovsky, A.</span>, <span class="refAuthor">McCall, D.</span>, and <span class="refAuthor">D. Schinazi</span>, <span class="refTitle">"The CONNECT-IP HTTP Method"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-cms-masque-connect-ip-02</span>, <time datetime="2021-08-27" class="refDate">27 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-cms-masque-connect-ip-02">https://datatracker.ietf.org/doc/html/draft-cms-masque-connect-ip-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP-DGRAM">[HTTP-DGRAM]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">L. Pardue</span>, <span class="refTitle">"HTTP Datagrams and the Capsule Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-masque-h3-datagram-11</span>, <time datetime="2022-06-17" class="refDate">17 June 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-masque-h3-datagram-11">https://datatracker.ietf.org/doc/html/draft-ietf-masque-h3-datagram-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC0792">[RFC0792]</dt>
        <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"Internet Control Message Protocol"</span>, <span class="seriesInfo">STD 5</span>, <span class="seriesInfo">RFC 792</span>, <span class="seriesInfo">DOI 10.17487/RFC0792</span>, <time datetime="1981-09" class="refDate">September 1981</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc792">https://www.rfc-editor.org/rfc/rfc792</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3168">[RFC3168]</dt>
        <dd>
<span class="refAuthor">Ramakrishnan, K.</span>, <span class="refAuthor">Floyd, S.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"The Addition of Explicit Congestion Notification (ECN) to IP"</span>, <span class="seriesInfo">RFC 3168</span>, <span class="seriesInfo">DOI 10.17487/RFC3168</span>, <time datetime="2001-09" class="refDate">September 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc3168">https://www.rfc-editor.org/rfc/rfc3168</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4443">[RFC4443]</dt>
        <dd>
<span class="refAuthor">Conta, A.</span>, <span class="refAuthor">Deering, S.</span>, and <span class="refAuthor">M. Gupta, Ed.</span>, <span class="refTitle">"Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 89</span>, <span class="seriesInfo">RFC 4443</span>, <span class="seriesInfo">DOI 10.17487/RFC4443</span>, <time datetime="2006-03" class="refDate">March 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4443">https://www.rfc-editor.org/rfc/rfc4443</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
        <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8200">https://www.rfc-editor.org/rfc/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8941">[RFC8941]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="seriesInfo">RFC 8941</span>, <span class="seriesInfo">DOI 10.17487/RFC8941</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8941">https://www.rfc-editor.org/rfc/rfc8941</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9000">[RFC9000]</dt>
      <dd>
<span class="refAuthor">Iyengar, J., Ed.</span> and <span class="refAuthor">M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="seriesInfo">RFC 9000</span>, <span class="seriesInfo">DOI 10.17487/RFC9000</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9000">https://www.rfc-editor.org/rfc/rfc9000</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.westerlund-masque-transport-issues">[I-D.westerlund-masque-transport-issues]</dt>
        <dd>
<span class="refAuthor">Westerlund, M.</span>, <span class="refAuthor">Ihlar, L. M.</span>, <span class="refAuthor">Sarker, Z.</span>, and <span class="refAuthor">M. Kühlewind</span>, <span class="refTitle">"Transport Considerations for IP and UDP Proxying in MASQUE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-westerlund-masque-transport-issues-02</span>, <time datetime="2021-07-12" class="refDate">12 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-westerlund-masque-transport-issues-02">https://datatracker.ietf.org/doc/html/draft-westerlund-masque-transport-issues-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2474">[RFC2474]</dt>
      <dd>
<span class="refAuthor">Nichols, K.</span>, <span class="refAuthor">Blake, S.</span>, <span class="refAuthor">Baker, F.</span>, and <span class="refAuthor">D. Black</span>, <span class="refTitle">"Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers"</span>, <span class="seriesInfo">RFC 2474</span>, <span class="seriesInfo">DOI 10.17487/RFC2474</span>, <time datetime="1998-12" class="refDate">December 1998</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2474">https://www.rfc-editor.org/rfc/rfc2474</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="changes">
<section id="appendix-A">
      <h2 id="name-changes-from-draft-kuehlewi">
<a href="#name-changes-from-draft-kuehlewi" class="section-name selfRef">Changes from draft-kuehlewind-masque-connect-ip-01</a>
      </h2>
<p id="appendix-A-1">The overwhelming majority of the content in this draft was copied from
draft-kuehlewind-masque-connect-ip-01. The editor made the following minor
changes in order to make Flow Forwarding Mode compatible with CONNECT-IP:<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="appendix-A-2">
        <dt id="appendix-A-2.1">Negotiation of Flow Forwarding Mode:</dt>
        <dd style="margin-left: 1.5em" id="appendix-A-2.2">
          <p id="appendix-A-2.2.1">draft-kuehlewind-masque-connect-ip-01 uses the ":authority" pseudo-header to
differentiate between flow forwarding mode and regular CONNECT-IP. Since many
HTTP servers are responsible for multiple authorities, this document instead
uses a new HTTP header "Flow-Forwarding" to communicate whether flow forwarding
mode is in use.<a href="#appendix-A-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="appendix-A-2.3">HTTP Datagram Context IDs:</dt>
        <dd style="margin-left: 1.5em" id="appendix-A-2.4">
          <p id="appendix-A-2.4.1">draft-kuehlewind-masque-connect-ip-01 left registration of context IDs as
future work, which prevented implementing the proposal. This draft defines two
new capsules to register context IDs and register their associated formats.<a href="#appendix-A-2.4.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">To Be Determined</span></div>
<div dir="auto" class="left"><span class="org">MASQUE Enthusiasts LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dschinazi.ietf@gmail.com" class="email">dschinazi.ietf@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
